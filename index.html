<!doctype html>
<html lang="en">
  <head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-133738054-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-133738054-2');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
    <link rel="stylesheet" href="assets/modal-fx.min.css">
    <link rel="stylesheet" href="assets/bulma-tooltip.min.css">
    <script async type="text/javascript" src="assets/modal-fx.min.js"></script>
    <script async type="text/javascript" src="assets/jquery-3.3.1.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <script type="text/javascript">
      function cTC() {
        var cText = document.getElementById("theirname");
        if(cText == "") {
          document.getElementById("theirname").classlist.add("is-danger");
        } else {
          document.getElementById("theirname").classList.add("is-success")
          cText.select();
          document.execCommand("copy");
        }
      }
      function gUV() {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
          vars[key] = value;
        });
        return vars;
      }
      function gUP(parameter, defaultvalue){
        var urlparameter = defaultvalue;
        if(window.location.href.indexOf(parameter) > -1){
          urlparameter = gUV()[parameter];
        }
        return urlparameter;
      }
      function getName() {
        if(gUP("to", "blank") != "blank") {
          document.getElementById("name").innerHTML = "Hey, " + gUV()['to'] + "...";
        } else {
          document.getElementById('name').innerHTML = "Hey " + document.getElementById('inputname').value + "...";
        }
      }
      function getMsg() {
        if(gUP("msg", "blank") != "blank") {
          document.getElementById("yourmessage").innerHTML = atob(gUV()['msg']);
        } else {
          document.getElementById('yourmessage').innerHTML = "üåπüòòüíï";
        }
      }
      function fillUrl() {
        document.getElementById('theirname').value = "https://vday.hauteclaire.me/?to=" + document.getElementById('inputname').value + "&msg=" + btoa(document.getElementById('message').value);
      }
      function shortenUrl() {
        var fData = new FormData();
        var xhr = new XMLHttpRequest();
        console.log("Sending name " + document.getElementById('inputname').value + " to link shortener...");
        fData.append("url","https://vday.hauteclaire.me/?to=" + document.getElementById('inputname').value + "&msg=" + btoa(document.getElementById('message').value));

        console.log(xhr.status);
        xhr.onreadystatechange = function() {
          if (xhr.readyState == 4 && this.status == 200) {
            document.getElementById('theirname').value = xhr.responseText;
          }
        };
        xhr.open("POST","https://l.hauteclaire.me/create");
        xhr.send(fData);
      }
    </script>
    <style>
      body {
        background: radial-gradient(#ff0000, #820000);
        font-family: 'Pacifico', cursive;
      }
    </style>
    <title>‚ù§</title>
  </head>
  <body onload="getName(); getMsg();">
    <div id="irasshai" class=" modal modal-fx-fadeInScale">
      <div class="modal-background" style="background-color: #ffffff"></div>
        <div class="modal-content">
          <p>Send the given link to that special someone.</p>
          <form class="field is-grouped" method="get">
            <p class="control is-large is-expanded">
              <input class="input" id="inputname" type="text" placeholder="What's their name?" onkeyup="getName(); fillUrl();" name="to" required />
              <input class="input" placeholder="Your special message (optional)" type="text" id="message" onkeyup="getMsg(); fillUrl();" name="msg"></input>
            </p>
            <p class="control is-large">
              <a class="button is-danger is-outlined" data-tooltip="Shorten this url" onClick="shortenUrl();">
                <i class="fa fa-heart"></i>
              </a>
            </p>
          </form>
          <hr />
          <div class="control">
            <input id="theirname" class="input tooltip" data-tooltip="Copy to clipboard" type="text" value="" placeholder="..." readonly onClick="cTC();">
          </div>
        </div>
    </div>
    <section class="hero is-bold is-fullheight">
      <div class="hero-body has-text-white">
        <div class="container has-text-centered">
          <h1 class="title has-text-white" style="font-size:56px" id="name">
          </h1>
          <a class="subtitle has-text-white" style="font-size:112px" onClick="irasshai.classList.toggle('is-active')">
            Happy Valentine's Day
          </a>
          <br />
          <br />
          <br />
          <h2 id="yourmessage" class="subtitle has-text-white">
          </h2>
        </div>
      </div>
    </section>
  </body>
</html>
